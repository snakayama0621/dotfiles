# ============================================================================
# tmux設定ファイル
# ============================================================================
# 参考: https://www.baeldung.com/linux/tmux-status-bar-customization
# ============================================================================

# ----------------------------------------------------------------------------
# 基本設定
# ----------------------------------------------------------------------------

# プレフィックスキーをC-sに変更（C-bより押しやすい）
set -g prefix C-s
unbind C-b

# マウス操作を有効化
set-option -g mouse on

# 256色サポート
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# エスケープタイムを短縮（Neovim推奨）
set -sg escape-time 10

# フォーカスイベントを有効化（Neovim autoread用）
set-option -g focus-events on

# ヒストリーサイズ
set -g history-limit 50000

# ウィンドウ番号を0から開始
set -g base-index 0
setw -g pane-base-index 0

# ウィンドウを閉じた時に番号を詰める
set -g renumber-windows on

# ----------------------------------------------------------------------------
# キーバインド
# ----------------------------------------------------------------------------

# ペイン分割
bind b split-window -h -c "#{pane_current_path}"
bind v split-window -v -c "#{pane_current_path}"

# セッション選択
bind s choose-tree -Zs

# 設定リロード
bind r source-file ~/.tmux.conf \; display-message "Config reloaded.."

# Vimライクなペイン移動
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Vimライクなペインリサイズ
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# 新しいウィンドウを現在のパスで開く
bind c new-window -c "#{pane_current_path}"

# ステータスバー表示/非表示切替
bind S set-option -g status

# ----------------------------------------------------------------------------
# コピーモード（Vim風）
# ----------------------------------------------------------------------------

setw -g mode-keys vi

# コピーモードでの選択
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# macOSクリップボード連携
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# ----------------------------------------------------------------------------
# ステータスバー設定
# ----------------------------------------------------------------------------

# ステータスバーを上部に表示
set -g status-position bottom

# 更新間隔（秒）
set -g status-interval 1

# ステータスバーの背景色・前景色
set -g status-style "bg=#1a1b26,fg=#a9b1d6"

# 左側：セッション名
set -g status-left-length 30
set -g status-left "#[fg=#7aa2f7,bold] #S #[default]"

# 右側：日時
set -g status-right-length 50
set -g status-right "#[fg=#565f89] %Y-%m-%d #[fg=#7aa2f7]%H:%M:%S "

# ウィンドウリスト（中央寄せ）
set -g status-justify centre

# ウィンドウのステータス表示
setw -g window-status-format "#[fg=#565f89] #I:#W "
setw -g window-status-current-format "#[fg=#7aa2f7,bold] #I:#W "

# ----------------------------------------------------------------------------
# ペイン境界線
# ----------------------------------------------------------------------------

# 非アクティブペインの境界線
set -g pane-border-style "fg=#3b4261"

# アクティブペインの境界線
set -g pane-active-border-style "fg=#7aa2f7"

# ----------------------------------------------------------------------------
# メッセージ・コマンドライン
# ----------------------------------------------------------------------------

# メッセージのスタイル
set -g message-style "bg=#1a1b26,fg=#7aa2f7"

# コマンドモードのスタイル
set -g message-command-style "bg=#1a1b26,fg=#7aa2f7"

# ----------------------------------------------------------------------------
# その他
# ----------------------------------------------------------------------------

# ベル音を無効化
set -g visual-bell off
set -g bell-action none

# アクティビティ監視
setw -g monitor-activity on
set -g visual-activity off
